// JavaScript Document
var maximo = 10;
var tabs;
var validator;
var nitems = 0;
var ndocumentos = 0;
$(document).ready(function() {
    validador();
    validadorFormDialog();
    validadorBusqueda();
    fechas();
    paginarResultados("ordenarlistar");
});
function marcarPadre(idCheck){
    var i;
    var codigo=$(idCheck).attr("codigo");
    var aux;

    if(idCheck.checked==true){
        while(codigo.length>2){
            codigo= codigo.substring(0,codigo.length-3);
            if(codigo.length!=0){
                for(i=0;i<document.getElementsByName("pertxt_txt").length;i++){
                    aux=document.getElementsByName("pertxt_txt")[i];
                    if($(aux).attr("codigo")==codigo){
                        document.getElementsByName("pertxt_txt")[i].checked=true;
                        break;
                    }
                }
            }
        }
    }
}
function cargarLista(id, url, tipo){
    document.getElementById(id).disabled = "disabled";
    if(url != ""){
        $.ajax({
            url: url,
            type: "POST",
            data: "",
            success: function(datos){
                if(tipo == 0){
                    $("#"+id).html("");
                    $("#"+id).append(datos);                    
                }
                if(tipo == 1){
                    document.getElementById(id).value = datos;
                }
                document.getElementById(id).disabled = false;                
            },
            error: function(){
                alert("Error en el procesamiento");
            }
        });
    }
    $('#'+id).show();
}
function fechas() {
    $(".fecha").datepicker({
        buttonImage: false,
        dateFormat: "dd-mm-yy",
        changeYear: true,
        numberOfMonths: 1
    });
    $(".fechajanium").datepicker({
        buttonImage: false,
        dateFormat: "yymmdd",
        changeYear: true,
        numberOfMonths: 1
    });
}
jQuery.fn.reset = function() {
    $(this).each(function() {
        this.reset();
    });
}
function validador() {
    validator = $("#FormAplication").validate({
        rules: {
        },
        messages: {
        },
        submitHandler: function() {
            //alert("alerta");
            try {
                if (ValidarCKEditor('FormAplication')) {
                    return false;
                }
            } catch (ex) {
                alert(ex);
            }
            var cadenaFormulario = $('#FormAplication').serialize();
            var request = $('#FormAplication #request').val();
            var funcion = $('#FormAplication #accion').val();
            alerta("Mensaje del Sistema", "espera", "dialog");
            //alert(cadenaFormulario);
            $.ajax({
                url: request,
                type: "POST",
                data: cadenaFormulario,
                contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
                //dataType: ($.browser.msie) ? "text" : "xml",
                dataType: "xml",
                success: function(datos) {
                    var xml;
                    /*if (typeof datos == 'string') {
                     xml = new ActiveXObject('Microsoft.XMLDOM');
                     xml.async = false;
                     xml.loadXML(datos);
                     } else {
                     }*/
                    xml = datos;
                    procesarRequest(xml);
                },
                error: function() {
                    alert("Error en el procesamiento");
                }
            });
        },
        success: function(label) {

        }
    });
    validator = $("#Seguridad").validate({
        rules: {
        },
        messages: {
        },
        submitHandler: function () {

            var cadenaFormulario = $('#Seguridad').serialize();
            var request = document.getElementById("request").value;
            var funcion = document.getElementById("accion").value;
            //alert(cadenaFormulario);
            if (funcion == "lrequerimiento") {
                var campos = document.getElementById("validar").value;
                if (campos != "") {
                    var vector = campos.split(",");
                    var lleno = 0;
                    for (a = 0; a < vector.length; a++) {
                        if (document.getElementById(vector[a]).value != "")
                            lleno++;
                    }
                } else
                    lleno = 1;
                if (lleno == 0) {
                    alert("Digite algun parametro de busqueda");
                    return 0;
                }
            }
            if (funcion == "listar") {
                if (document.getElementById("nombre_txt").value.length == 0 && document.getElementById("cedula_txt").value.length == 0) {
                    alerta("", "<center>Por favor ingrese por lo menos uno de<br>los dos parametros de busqueda<br><br><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog( \"close\" ); $(\"#mensaje\").remove();'></center>", "dialog");
                    return 0;
                }
            }

            /*if(funcion == "lusuario"){
             if(document.getElementById("nombre_txt").value.length==0 && document.getElementById("cedula_txt").value.length==0){
             alerta("", "<center>Por favor ingrese por lo menos uno de<br>los dos parametros de busqueda<br><br><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog( \"close\" ); $(\"#mensaje\").remove();'></center>", "dialog");
             return 0;
             }
             }*/

            alerta("Mensaje del Sistema", "espera", "dialog")
            $.ajax({
                url: request,
                type: "POST",
                dataType: "html",
                contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1;',
                data: cadenaFormulario,
                success: function (datos) {
                    procesar(funcion, datos);
                },
                error: function () {
                    alert("Error en el procesamiento");
                }
            });
        },
        success: function (label) {

        }
    });
   
}
function alerta(titulo, mensaje, id) {
    if (mensaje == "espera") {
        document.getElementById(id).innerHTML = "<div id='mensaje' title='" + titulo + "'><center><img src='images/procesando.gif'></center></div>";
    } else {
        document.getElementById(id).innerHTML = "<div id='mensaje' title='" + titulo + "'>" + mensaje + "</div>";
    }
    $("#mensaje").dialog({
        height: 'auto',
        width: 'auto',
        bgiframe: true,
        closeOnEscape: false,
        open: function(event, ui) {
            $(this).parent().children().children('.ui-dialog-titlebar-close').hide();
        },
        overlay: {
            opacity: 0.3,
            background: "black"
        },
        beforeClose: function(event, ui) {
            $("#mensaje").remove();
        },
        hide: "scale",
        modal: true
    });
}
function paginarResultados(id){
    $("."+id)
    .tablesorter({
        widthFixed: true, 
        widgets: ['zebra'], 
        headers: {
            0: {
                sorter: false
            }
        }
    })
    .tablesorterPager({
        container: $("#pager"),  
        size: 5
    });
}
function MensajeAlerta(titulo, mensaje, id) {
    
        document.getElementById(id).innerHTML = "<div id='mensaje' title='" + titulo + "'></div> ";
    
    $("#mensaje").dialog({
        height: 'auto',
        width: 'auto',
        bgiframe: true
    });
    
    $(document).ready(function() {
        var config = {
            toolbar: [
                ['Maximize', 'Bold', 'Italic', 'NumberedList', 'BulletedList', 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock', 'Format', 'Font', 'FontSize']],
            height: "80",
            width: "100%"
        };

        var contenido = CKEDITOR.replace('observ_txt', config);
        contenido.on('change', function() {
            contenido.updateElement();
        });
        contenido.on('blur', function() {
            contenido.updateElement();
        });
    });
}
function procesarRequest(response) {
    var respuesta = "";
    var errores = "";
    var html = "";
    var noprocesado = "";
    $(response).find("ejecucion").each(function() {
        respuesta += $(this).find("respuesta").text();
        errores += $(this).find("errores").text();
        html += $(this).find("codigo").text();
    });
    //alert(respuesta);
    $("#mensaje").dialog("destroy");
    $("#mensaje").remove();
    if (_isNumeric(respuesta)) {
        if (respuesta == 0) {
            if (html != "") {
                if (errores != "") {
                    html += "<br/><a href='javascript:void(null)' onclick='$(\"#errores\").show();'> Mostrar Errores </a></a><div id='errores' style='display:none;'>" + errores + "</div>";
                }
                ModalRequest("Mensaje del Sistema", html, "dialog");
            }
        }
        if (respuesta == 1) {
            if (html != "") {
                if (errores != "") {
                    html += "<br/><a href='javascript:void(null)' onclick='$(\"#errores\").show();'> Mostrar Errores </a></a><div id='errores' style='display:none;'>" + errores + "</div>";
                }
                ModalRequest("Mensaje del Sistema", html, "dialog");
            } else {
                ModalRequest("Mensaje del Sistema", "Proceso Realizado Correctamente <br/> <center>  <input type='button' value = 'Cerrar' onclick='location.href=\"hcg_lis_usu.jsp\"'  class='ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all'></center>", "dialog");
            }
        }
        if (respuesta == 2) {
            var pagina = $('#pagina_ocu').val();        ///crear en el formualrio campo oculto con el valor de la pagina a direccionar
            location.href = pagina;
        }
        if (respuesta == 3) {               ///crear en el formualrio campo oculto con el valor del id de la tabla o contenedor html
            var id = $('#iderec_ocu').val();
            alert(id);
            $('#' + id).html(html);
            LimpiarContenidos();
        }
    } else {
        if (errores != "") {
            noprocesado += "El proceso no se ha ejecutado <br/>";
            noprocesado += "<a href='javascript:void(null)' onclick='$(\"#errores\").show();'> Mostrar Errores </a><div id='errores' style='display:none;'>" + errores + "</div>";
            ModalRequest("Mensaje del Sistema", noprocesado, "dialog");
        }
    }
}
function LimpiarContenidos() {
    document.getElementById('Form-Dialog').reset();
    //$('#conten_txt').val('');
    CKEDITOR.instances["conten_txt"].setData('');
    CKEDITOR.instances["conten_txt"].updateElement();
    $('#t-items').html('');
}
function ventanaNueva(url) {
    var opciones = "left=100,top=100,width=800,height=500,toolbar=yes,resizable=yes";
    mi_ventana = window.open(url, "", opciones);
}
function _isNumeric(valor) {
    var _is = false;
    try {
        eval(valor);
        _is = true;
    } catch (ex) {
        _is = false;
    }
    return _is;
}
function direccionarlink(url) {
    if (url != "") {
        location.href = url;
    }
}
function ModalRequest(titulo, mensaje, id) {
    if (mensaje == "espera") {
        document.getElementById(id).innerHTML = "<div id='mensaje' title='" + titulo + "'><center><img src='images/cargando.gif'></center></div>";
    } else {
        document.getElementById(id).innerHTML = "<div id='mensaje' title='" + titulo + "'>" + mensaje + "</div>";
    }
    $("#mensaje").dialog({
        height: 'auto',
        width: 'auto',
        bgiframe: true,
        closeOnEscape: false,
        overlay: {
            opacity: 0.3,
            background: "black"
        },
        beforeClose: function(event, ui) {
            $("#mensaje").remove();
        },
        hide: "scale",
        modal: true
    });
    
}
function validadorBusqueda() {
    validator = $("#Form-Buscar").validate({
        rules: {
        },
        messages: {
        },
        submitHandler: function() {
            var cadenaFormulario = $('#Form-Buscar').serialize();
            var request = $('#Form-Buscar #request').val();
            var funcion = $('#Form-Buscar #accion').val();
            var texto = "";
            if ($('#Form-Buscar #validar').val() != '') {
                var campos = $('#Form-Buscar #validar').val();
                if (campos != "") {
                    var vector = campos.split(",");
                    var lleno = 0;
                    for (a = 0; a < vector.length; a++) {
                        //alert($('#' + vector[a]).attr('type'));
                        if ($('#' + vector[a]).attr("type") == 'checkbox') {
                            //alert($('#' + vector[a]).is("checked"));
                            if ($('#' + vector[a]).is(":checked")) {
                                lleno++;
                            }
                        } else {
                            if (document.getElementById(vector[a]).value != "")
                                lleno++;
                        }
                    }
                } else
                    lleno = 1;
                if (lleno == 0) {
                    alert("Digite algun parametro de busqueda");
                    return 0;
                }
            }
            alerta("Mensaje del Sistema", "espera", "dialog");
            $.ajax({
                url: request,
                type: "POST",
                data: cadenaFormulario,
                contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
                success: function(datos) {
                    procesar(funcion, datos);
                },
                error: function() {
                    alert("Error en el procesamiento");
                }
            });
        },
        success: function(label) {

        }
    });
}
function procesar(accion, datos) {
    accion = accion.toString();
    var validarsession = new String(datos);

    try {
        var n = validarsession.match(/exit/gi);
        if (n.length > 0) {
            $("#mensaje").dialog("destroy");
            $("#mensaje").remove();
            alerta("SU SESION A TERMINADO", "LO SENTIMOS SU SESION NO HA PODIDO VERIFICARSE <br/> <br/> <center><input type='button' value = 'Cerrar' onclick='location.href=\"fuera.jsp\"' class='ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all'></center>", "dialog")
            return false;
        }
    } catch (ex) {
    }
    if (accion == 'listar') {
        $("#mensaje").dialog("destroy");
        $("#mensaje").remove();
        $('#panelResultados').html('');
        $('#panelResultados').append(datos);
        //$(".ui-dialog-titlebar-close").show();
    }
    if (accion == 'enviarusuarios') {
        $("#mensaje").dialog("destroy");
        $("#mensaje").remove();
        $('#panelProcesamiento').html('');
        $('#panelProcesamiento').append(datos);
        $("#FormAplicationBuscar").submit();
    }
    if(accion == "agregarfamiliar"){
        if(_isNumeric(datos)){
            if(validarsession != 0){
                $("#mensaje").html("Se ha guardado Correctamente <br/> <input type='button' value = 'Cerrar' onclick='location.href=\"hcg_hcb_apl.jsp\"'>");
            }
            if(validarsession == 0){
                $("#mensaje").html("LA OPERACION NO SE HA COMPLETADO <br/> <br/> <center><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog( \"destroy\" );'></center>");
            }
        }else{
            alert("Se presento un problema en el Servidor \n Intentelo mas tarde");
        }
    }
    if(accion == "agregarfamiliar"){
        if(_isNumeric(datos)){
            if(validarsession != 0){
                $("#mensaje").html("Se ha guardado Correctamente <br/> <input type='button' value = 'Cerrar' onclick='location.href=\"hcg_hcb_apl.jsp\"'>");
            }
            if(validarsession == 0){
                $("#mensaje").html("LA OPERACION NO SE HA COMPLETADO <br/> <br/> <center><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog( \"destroy\" );'></center>");
            }
        }else{
            alert("Se presento un problema en el Servidor \n Intentelo mas tarde");
        }
    }
    if(accion == "agrevolucion"){
        if(_isNumeric(datos)){
            if(validarsession != 0){
                $("#mensaje").html("Se ha guardado Correctamente <br/> <center> <input type='button' value = 'Cerrar' onclick='location.href=\"hcg_hcb_evo.jsp\"'> </center>");
            }
            if(validarsession == 0){
                $("#mensaje").html("LA OPERACION NO SE HA COMPLETADO <br/> <br/> <center><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog( \"destroy\" );'></center>");
            }
        }else{
            alert("Se presento un problema en el Servidor \n Intentelo mas tarde");
        }
    }
    if(accion == "agregarantpersonal"){
        if(_isNumeric(datos)){
            if(validarsession != 0){
                $("#mensaje").html("Se ha guardado Correctamente <br/> <input type='button' value = 'Cerrar' onclick='location.href=\"hcg_hcb_ant.jsp\"'>");
            }
            if(validarsession == 0){
                $("#mensaje").html("LA OPERACION NO SE HA COMPLETADO <br/> <br/> <center><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog( \"destroy\" );'></center>");
            }
        }else{
            alert("Se presento un problema en el Servidor \n Intentelo mas tarde");
        }
    }
    if(accion == "agregarantfamilia"){
        if(_isNumeric(datos)){
            if(validarsession != 0){
                $("#mensaje").html("Se ha guardado Correctamente <br/> <input type='button' value = 'Cerrar' onclick='location.href=\"hcg_hcb_ant.jsp\"'>");
            }
            if(validarsession == 0){
                $("#mensaje").html("LA OPERACION NO SE HA COMPLETADO <br/> <br/> <center><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog( \"destroy\" );'></center>");
            }
        }else{
            alert("Se presento un problema en el Servidor \n Intentelo mas tarde");
        }
    }
    if(accion=="lsolicitud"){
        document.getElementById('panel').innerHTML = datos;
        $("#mensaje").hide();
        $("#mensaje").dialog( "destroy" );
        $("#mensaje").remove();
        paginarResultados('tablesorter');
    }
    return false;
}
function SeleccionarChecks(id, clase) {
    if ($('#' + id).is(':checked')) {
        $("." + clase).prop('checked', true);
    } else {
        $("." + clase).prop('checked', false);
    }
    ContarChecks(clase);
}
function ContarChecks(clase) {
    $("#numsel_txt").val($('input.' + clase + ':checkbox:checked').size());
}
function ProcesarSelecciones(clase, form) {
    if ($("." + clase + ":checked").size() < 1) {
        alert("Ninguna Registro Seleccionado");
        return false;
    }
    if ($("#vigenc_txt").val() == '') {
        alert("El Campo de Vigencia es Obligatorio");
        $("#vigenc_txt").focus();
        return false;
    }
    alerta("Mensaje del Sistema", "espera", "dialog");
    var cadenaFormulario = $('#' + form).serialize();
    //alert(cadenaFormulario);
    $.ajax({
        url: "jan_usu_epr.jsp",
        type: "POST",
        data: cadenaFormulario,
        cache: false,
        success: function(datos) {
            procesar('enviarusuarios', datos);
        },
        error: function() {
            alert("Error en el procesamiento");
        }
    });
}
function ventanaCerrar() {
    if (confirm("Esta seguro de salir de la Aplicacion")) {
        var opciones = "width=260, height=105, screenX=0, screenY=0, top=0, left=0, scrollbars=no, status=no, resizable=no";
        mi_close = window.open("fueraX.jsp", "FUERA", opciones);
        parent.window.close();
    }
}
function pasarMayusculas(cadena, id) {
    var result="";
    var str = cadena.split('');
 
    for(i=0; i<=str.length-1; i++) {
        str[i] = str[i].toUpperCase();
        result+=str[i];
    }
    //alert(result); 
    document.getElementById(id).value = result;
}
function ValidarCKEditor(FormId) {
    var respuesta = false;
    try {
        for (var i in CKEDITOR.instances) {
            CKEDITOR.instances[i].updateElement();
            if (CKEDITOR.instances[i].getData() == "") {
                var requerido = 0;
                try {
                    if (FormId != '' && FormId != undefined) {
                        //alert('#' + FormId + ' #' + CKEDITOR.instances[i].name);
                        var clases = $('#' + FormId + ' #' + CKEDITOR.instances[i].name).attr('class').split(/\s+/);
                        //alert("con form id " + clases.length);
                    } else {
                        //alert('#' + CKEDITOR.instances[i].name);
                        var clases = $('#' + CKEDITOR.instances[i].name).attr('class').split(/\s+/);
                        //alert("Sin form id " + clases.length);
                    }
                    for (a = 0; a < clases.length; a++) {
                        if (clases[a] == 'required') {
                            requerido = 1;
                            break;
                        }
                    }
                } catch (ex) {
                    console.log("No soportado CKEDITOR ERROR  : " + ex);
                }
                if (requerido != 0) {
                    alert('No se ha generado Contenido para el campo de texto.')
                    CKEDITOR.instances[i].focus();
                    respuesta = true;
                    break;
                }
            }
        }
    } catch (ex) {
    }
    return respuesta;
}
function ProcesarOpciones(operacion) {
    switch(operacion){
        
        case  1: 
            var ind = "";
            if ($("input[name='indeve_rad']:radio").is(':checked')) {
                ind = $("input:radio[name='indeve_rad']:checked").val();
                location.href = "fic_fic_agr.jsp?oper=retomar&ind=" + ind;
            } else {
                $("#errores").html("<strong>Debe seleccionar una opcion.</strong>");
            }
            break;
    
        case 2: 
     
            var ind = "";
            if ($("input[name='indeve_rad']:radio").is(':checked')) {
                ind = $("input:radio[name='indeve_rad']:checked").val();
                location.href = "fic_fic_agr.jsp?oper=descartar&ind=" + ind;
            } else {
                $("#errores").html("<strong>Debe seleccionar una opcion.</strong>");
            }
            break;
            
         case  3: 
            var ind = "";
            if ($("input[name='indeve_rad']:radio").is(':checked')) {
                ind = $("input:radio[name='indeve_rad']:checked").val();
                location.href = "fic_fic_mod.jsp?oper=retomar&ind=" + ind;
            } else {
                $("#errores").html("<strong>Debe seleccionar una opcion.</strong>");
            }
            break;
    
        case 4: 
     
            var ind = "";
            if ($("input[name='indeve_rad']:radio").is(':checked')) {
                ind = $("input:radio[name='indeve_rad']:checked").val();
                location.href = "fic_fic_mod.jsp?oper=descartar&ind=" + ind;
            } else {
                $("#errores").html("<strong>Debe seleccionar una opcion.</strong>");
            }
            break;
            
        case 5: 
     
            var ind = "";
            if ($("input[name='indeve_rad']:radio").is(':checked')) {
                ind = $("input:radio[name='indeve_rad']:checked").val();
                location.href = "fic_apr_dec.jsp?oper=retomar&ind=" + ind;
            } else {
                $("#errores").html("<strong>Debe seleccionar una opcion.</strong>");
            }
            break;
    }
}
function FormDialog(url, widht, height, titulo) {
    CerrarFormDialog();
    $("body").append('<div id="FormDialog"></div>');
    $('#FormDialog').dialog({
        modal: true,
        open: function()
        {
            $(this).load(url + "&ramdon=" + new Date().getTime());
        },
        close: function(event, ui) {
            CKEDITOR.remove(CKEDITOR.instances['conten_txt']);
        },
        height: height,
        width: widht,
        title: titulo,
        position: 'center top',
        bgiframe: true,
        hide: "scale",
        show: "scale"
    });

}
function validadorFormDialog() {
    validator = $("#Form-Dialog").validate({
        rules: {
        },
        messages: {
        },
        submitHandler: function() {
            try {
                if (ValidarCKEditor()) {
                    return false;
                }
            } catch (ex) {
                alert(ex);
            }
            var cadenaFormulario = $('#Form-Dialog').serialize();
            var request = $('#Form-Dialog #request').val();
            var funcion = $('#Form-Dialog #accion').val();
            alerta("Mensaje del Sistema", "espera", "dialog");
            $.ajax({
                url: request,
                type: "POST",
                data: cadenaFormulario,
                contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
                //dataType: ($.browser.msie) ? "text" : "xml",
                dataType: "xml",
                success: function(datos) {
                    var xml;
                    /*if (typeof datos == 'string') {
                     xml = new ActiveXObject('Microsoft.XMLDOM');
                     xml.async = false;
                     xml.loadXML(datos);
                     } else {
                     }*/
                    xml = datos;
                    procesarRequest(xml);
                },
                error: function() {
                    alert("Error en el procesamiento");
                }
            });
        },
        success: function(label) {

        }
    });
    /*validator = $("#Form-Dialog").validate({
     rules: {
     },
     messages: {
     },
     submitHandler: function() {
     // alert("");
     var cadenaFormulario = $('#Form-Dialog').serialize();
     var request = $('#Form-Dialog #request').val();
     var funcion = $('#Form-Dialog #accion').val();
     var texto = "";
     // alert(cadenaFormulario);
     if (funcion == "lrequerimiento") {
     var campos = document.getElementById("validar").value;
     if (campos != "") {
     var vector = campos.split(",");
     var lleno = 0;
     for (a = 0; a < vector.length; a++) {
     if (document.getElementById(vector[a]).value != "")
     lleno++;
     }
     } else
     lleno = 1;
     if (lleno == 0) {
     alert("Digite algun parametro de busqueda");
     return 0;
     }
     }
     
     if (request == "car_nfp.jsp") {
     if (!confirm("Esta seguro de Generar Esta Novedad en la Carga Docente ?")) {
     return false;
     }
     }
     
     alerta("Mensaje del Sistema", "espera", "dialog");
     //alert(cadenaFormulario);
     $.ajax({
     url: request,
     type: "POST",
     data: cadenaFormulario,
     contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
     success: function(datos) {
     //alert(funcion);
     procesarRequest(datos);
     },
     error: function() {
     alert("Error en el procesamiento");
     }
     });
     
     },
     success: function(label) {
     
     }
     });*/
    validator = $("#DaialogAplication").validate({
        rules: {
        },
        messages: {
        },
        submitHandler: function() {
            var cadenaFormulario = $('#DaialogAplication').serialize();
            //alert(cadenaFormulario);
            var request = $('#DaialogAplication #request').val();
            var funcion = $('#DaialogAplication #accion').val();
            //alert(request);
            var texto = "";
            if(funcion == "agregarItem"){
                var item = $('#item').val();
                var configuracion = "";
                
                if($('#config').val() == 0){
                    configuracion = '<td><input type="hidden" name="elebie_ocu'+item+'" value = "'+$('#carbie_sel').val()+'" />'+$('#carbie_sel option:selected').text()+'</td>';
                }
                
                if($('#config').val() == 1){                    
                    var elementobien = document.getElementsByName('ideelb_ocu');
                    var caracterbien = document.getElementsByName('carbie_sel');
                    configuracion = '<td>';
                    for(a = 0;a < elementobien.length; a++){
                        configuracion = configuracion + '<input type="hidden" name="elebie_ocu'+item+'" value = "'+$(elementobien[a]).val()+'" />\r\n'+$(elementobien[a]).attr('descripcion')+' : \r\n';
                        configuracion = configuracion + '<input type="hidden" name="cabocu_ocu'+item+'" value = "'+$(caracterbien[a]).val()+'" />\r\n'+$('#'+caracterbien[a].id+' option:selected').text()+'<br/>\r\n';
                    }
                    configuracion = configuracion + '</td>';
                    
                }
                
                if($('#config').val() == 2){
                    configuracion = '<td></td>';
                }
                
                var tds =   '<tr id="eliminar'+item+'">'+
                '<td><input type="hidden" name="numite_ocu" value = "'+item+'" /><input type="hidden" name="tipcon_ocu" value = "'+$('#config').val()+'" />'+item+'</td>'+
                '<td><input type="hidden" name="casocu_ocu'+item+'" value = "'+$('#cansol_txt').val()+'" />'+$('#cansol_txt').val()+'</td>'+
                '<td><input type="hidden" name="tibocu_ocu'+item+'" value = "'+$('#tipobi_sel').val()+'" />'+$('#tipobi_sel option:selected').text()+'</td>'+
                configuracion+
                '<td><input type="hidden" name="desocu_ocu'+item+'" value = "'+$('#descri_txt').val()+'" />'+$('#descri_txt').val()+'</td>'+
                '<td><a href="javascript:void(0)" onclick="eliminarfila(\'eliminar'+item+'\', \'\')">X</a></td>'+
                '</tr>';
                $("#items").append(tds);
                item = parseInt(item, 10) + 1;
                $('#item').val(item);
            }else{
                alerta("Mensaje del Sistema", "espera", "dialog")
                $.ajax({
                    url: request,
                    type: "POST",
                    data: cadenaFormulario,
                    success: function(datos){                   
                        procesar(funcion, datos);
                    },
                    error: function(){
                        alert("Error en el procesamiento");
                    }
                });
            }
        },
        success: function(label) {
						
        }
    });
}
function paginarResultados(id){
    $("."+id)
    .tablesorter({
        widthFixed: true, 
        widgets: ['zebra'], 
        headers: {
            0: {
                sorter: false
            }
        }
    })
    .tablesorterPager({
        container: $("#pager"),  
        size: 5
    });
}
function validarSeleccion(name, form, campovalue){
    try{
        var lista = document.getElementsByName(name);
        for(a=0;a < lista.length; a++){
            if(lista[a].checked){
                document.getElementById(campovalue).value = lista[a].value;
            }
        }
        if(document.getElementById(campovalue).value != ""){
            document.getElementById(form).submit();
        }else{
            alerta("", "<center>Ninguna seleccion encontrada<br><br><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog( \"destroy\" ); $(\"#mensaje\").remove();'></center>", "dialog");
        }
    }
    catch(ex){
        alerta("", "<center>Ninguna seleccion encontrada<br><br><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog( \"destroy\" ); $(\"#mensaje\").remove();'></center>", "dialog");
    }
}
function validadorFormTableBuscar() {
    validator = $("#Form-TableBuscar").validate({
        rules: {},
        messages: {},
        submitHandler: function() {
            try {
                if (ValidarCKEditor('Form-TableBuscar')) {
                    return false;
                }
            } catch (ex) {
                alert(ex);
            }
            var cadenaFormulario = $('#Form-TableBuscar').serialize();
            var request = $('#Form-TableBuscar #request').val();
            var funcion = $('#Form-TableBuscar #accion').val();
            alerta("Mensaje del Sistema", "espera", "dialog");
            $.ajax({
                url: request,
                type: "POST",
                data: cadenaFormulario,
                contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
                //dataType: ($.browser.msie) ? "text" : "xml",
                dataType: "xml",
                success: function(datos) {
                    var xml;
                    xml = datos;
                    procesarRequest(xml);
                },
                error: function() {
                    alert("Error en el procesamiento");
                }
            });
        },
        success: function(label) {

        }
    });
}
function EliminarFila(ind, url, obj, modulo) {
    var cadenaFormulario = "indexm_ocu=" + ind;
    alerta("Mensaje del Sistema", "espera", "dialog");
    $.ajax({
        url: url,
        type: "POST",
        data: cadenaFormulario,
        contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
        dataType: "xml",
        success: function(datos) {
            var xml;
            xml = datos;
            var respuesta = "";
            var errores = "";
            var html = "";
            var noprocesado = "";
            $(xml).find("ejecucion").each(function() {
                respuesta += $(this).find("respuesta").text();
                errores += $(this).find("errores").text();
                html += $(this).find("codigo").text();
            });
            $("#mensaje").dialog("destroy");
            $("#mensaje").remove();
            if (_isNumeric(respuesta)) {
                if (respuesta == 1) {

                    if (modulo == 'EliminarModulo') {
                        $($(obj).parent().parent()).remove();
                    }

                    if (html != "") {
                        if (errores != "") {
                            html += "<br/><a href='javascript:void(null)' onclick='$(\"#errores\").show();'> Mostrar Errores </a></a><div id='errores' style='display:none;'>" + errores + "</div>";
                        }
                        ModalRequest("Mensaje del Sistema", html, "dialog");
                    }
                }
            } else {
                if (errores != "") {
                    noprocesado += "El proceso no se ha ejecutado <br/>";
                    noprocesado += "<a href='javascript:void(null)' onclick='$(\"#errores\").show();'> Mostrar Errores </a><div id='errores' style='display:none;'>" + errores + "</div>";
                    ModalRequest("Mensaje del Sistema", noprocesado, "dialog");
                }
            }
        },
        error: function() {
            alert("Error en el procesamiento");
        }
    });
}
function RegargarTag(id, url, tipo) {
    //alert(url);
    if (url != "") {
        $.ajax({
            url: url,
            type: "POST",
            data: "",
            success: function(datos) {
                //alert(datos);
                if (tipo == 'select') {
                    $("#" + id).html("");
                    $("#" + id).append(datos);
                }
                if (tipo == 'table') {
                    $("#" + id).html("");
                    $("#" + id).append(datos);
                }
            },
            error: function() {
                alert("Error en el procesamiento");
            }
        });
    }
}
function EnviarOperacion(url, obj, modulo) {
    if (modulo == 'eliminarContenido') {
        if (!confirm("Eliminar El Contenido y Su Intensidad ?")) {
            return false;
        }
    }
    alerta("Mensaje del Sistema", "espera", "dialog");
    $.ajax({
        url: url,
        type: "POST",
        data: "modulo=" + modulo,
        contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
        dataType: "xml",
        success: function(datos) {
            var xml;
            xml = datos;
            var respuesta = "";
            var errores = "";
            var html = "";
            var noprocesado = "";
            $(xml).find("ejecucion").each(function() {
                respuesta += $(this).find("respuesta").text();
                errores += $(this).find("errores").text();
                html += $(this).find("codigo").text();
            });
            $("#mensaje").dialog("destroy");
            $("#mensaje").remove();
            if (_isNumeric(respuesta)) {
                if (respuesta == 1) {
                    if (modulo == 'crearregistro') {
                        var nodo = buscarXML(xml, "idpersona");
                        if (nodo != "") {
                            $('#confer_txt').val($('#' + obj + ' td.NombrePersona').text());
                            $('#idecon_ocu').val(nodo);
                            CerrarFormDialog();
                        }
                        if (html != "") {
                            if (errores != "") {
                                html += "<br/><a href='javascript:void(null)' onclick='$(\"#errores\").show();'> Mostrar Errores </a></a><div id='errores' style='display:none;'>" + errores + "</div>";
                            }
                            ModalRequest("Mensaje del Sistema", html, "dialog");
                        }
                    }

                    if (modulo == 'eliminarIntensidad') {
                        $('#t-items').html(html);
                        SumarClase('i-horas', 'cantin_txt');
                    }

                    if (modulo == 'eliminarContenido') {
                        $('#t-contenidos').html(html);
                        SumarClase('i-contenidos', 'cantco_txt');
                    }
                }
                if (respuesta == 0) {
                    if (errores != "") {
                        noprocesado += "El proceso no se ha ejecutado <br/>";
                        noprocesado += "<center><input type='button' value = 'Cerrar' onclick='$(\"#mensaje\").dialog(\"destroy\"); $(\"#mensaje\").remove()'  class='ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all'></center> <br/>";
                        noprocesado += "<a href='javascript:void(null)' onclick='$(\"#errores\").show();'> Mostrar Errores </a><div id='errores' style='display:none;'>" + errores + "</div>";
                        ModalRequest("Mensaje del Sistema", noprocesado, "dialog");
                    }
                }
            } else {
                if (errores != "") {
                    noprocesado += "El proceso no se ha ejecutado <br/>";
                    noprocesado += "<a href='javascript:void(null)' onclick='$(\"#errores\").show();'> Mostrar Errores </a><div id='errores' style='display:none;'>" + errores + "</div>";
                    ModalRequest("Mensaje del Sistema", noprocesado, "dialog");
                }
            }
        },
        error: function() {
            alert("Error en el procesamiento");
        }
    });
}
function CerrarFormDialog() {
    $("#FormDialog").dialog("destroy");
    $("#FormDialog").remove();
}
function buscarXML(xml, nodo) {
    var valor = "";
    $(xml).find("ejecucion").each(function() {
        valor += $(this).find(nodo).text();
    });
    return valor;
}
function Intensidad() {
    var error = 0;
    if ($('#duraci_txt').val() == '' || $('#duraci_txt').val() == '0') {
        error++;
    } else if ($('#horafi_sel').val() == '') {
        error++;
    } else if ($('#horain_sel').val() == '') {
        error++;
    } else if ($('#fecint_txt').val() == '') {
        error++;
    }
    if (error < 1) {
        alerta("Mensaje del Sistema", "espera", "dialog");
        var options = $('form[name=Form-Dialog]').find('input, textarea, select').filter('.intensidad').serialize();
        $.ajax({
            url: "fic_fic_pro.jsp?modulo=intensidad",
            type: "POST",
            data: options,
            contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
            dataType: "xml",
            success: function(datos) {
                var xml;
                xml = datos;
                var respuesta = "";
                var errores = "";
                var html = "";
                var noprocesado = "";
                $(xml).find("ejecucion").each(function() {
                    respuesta += $(this).find("respuesta").text();
                    errores += $(this).find("errores").text();
                    html += $(this).find("codigo").text();
                });
                $("#mensaje").dialog("destroy");
                $("#mensaje").remove();
                if (_isNumeric(respuesta)) {
                    if (respuesta == 1) {
                        if (html != "") {
                            $('#t-items').html(html);
                            SumarClase('i-horas', 'cantin_txt');
                        }
                    }
                    if (respuesta == 0) {
                        ModalRequest("Mensaje del Sistema", html, "dialog");
                    }
                } else {
                    if (errores != "") {
                        noprocesado += "El proceso no se ha ejecutado <br/>";
                        noprocesado += "<a href='javascript:void(null)' onclick='$(\"#errores\").show();'> Mostrar Errores </a><div id='errores' style='display:none;'>" + errores + "</div>";
                        ModalRequest("Mensaje del Sistema", noprocesado, "dialog");
                    }
                }
            },
            error: function() {
                alert("Error en el procesamiento");
            }
        });
    }
}
function SumarClase(clase, id) {
    var suma = 0;
    $('.' + clase).each(function() {
        suma += parseInt($(this).text())
    })
    $('#' + id).val(suma);
}
/*************************************************************/
/****************  IDIOMA CALENDARIO *************************/
/*************************************************************/
jQuery(function($) {
    $.datepicker.regional['es'] = {
        closeText: 'Cerrar',
        prevText: '&#x3c;Ant',
        nextText: 'Sig&#x3e;',
        currentText: 'Hoy',
        monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
        monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
            'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
        dayNames: ['Domingo', 'Lunes', 'Martes', 'Mi&eacute;rcoles', 'Jueves', 'Viernes', 'S&aacute;bado'],
        dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mi&eacute;', 'Juv', 'Vie', 'S&aacute;b'],
        dayNamesMin: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'S&aacute;'],
        weekHeader: 'Sm',
        dateFormat: 'dd/mm/yy',
        firstDay: 1,
        isRTL: false,
        showMonthAfterYear: false,
        yearSuffix: ''
    };
    $.datepicker.setDefaults($.datepicker.regional['es']);
});
/*************************************************************/
/****************  IDIOMA CALENDARIO *************************/
/*************************************************************/